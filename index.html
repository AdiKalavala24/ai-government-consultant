<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CIVIC · AI Strategic Advisor</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --navy: #0a1628;
    --deep: #0d1f3c;
    --gold: #c9a84c;
    --gold-light: #e8c96a;
    --cream: #f5f0e8;
    --slate: #4a5568;
    --muted: #8a9bb0;
    --border: rgba(201,168,76,0.2);
    --glow: rgba(201,168,76,0.08);
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    background: var(--navy);
    color: var(--cream);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Subtle grid background */
  body::before {
    content:'';
    position:fixed;
    inset:0;
    background-image: 
      linear-gradient(rgba(201,168,76,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(201,168,76,0.03) 1px, transparent 1px);
    background-size: 60px 60px;
    pointer-events:none;
    z-index:0;
  }

  .container {
    position: relative;
    z-index:1;
    max-width: 900px;
    margin: 0 auto;
    padding: 0 24px;
  }

  /* Header */
  header {
    border-bottom: 1px solid var(--border);
    padding: 20px 0;
    background: rgba(10,22,40,0.9);
    backdrop-filter: blur(10px);
    position: sticky;
    top:0;
    z-index:100;
  }

  .header-inner {
    display:flex;
    align-items:center;
    justify-content:space-between;
    max-width:900px;
    margin:0 auto;
    padding:0 24px;
  }

  .logo {
    display:flex;
    align-items:center;
    gap:12px;
  }

  .logo-mark {
    width:36px;
    height:36px;
    border:2px solid var(--gold);
    display:flex;
    align-items:center;
    justify-content:center;
    font-family:'DM Mono', monospace;
    font-size:14px;
    color:var(--gold);
    font-weight:500;
    position:relative;
  }

  .logo-mark::before {
    content:'';
    position:absolute;
    inset:-4px;
    border:1px solid rgba(201,168,76,0.2);
  }

  .logo-text {
    font-family:'Playfair Display', serif;
    font-size:20px;
    font-weight:700;
    letter-spacing:3px;
    color:var(--cream);
  }

  .logo-sub {
    font-family:'DM Mono', monospace;
    font-size:10px;
    color:var(--gold);
    letter-spacing:2px;
    text-transform:uppercase;
  }

  .status-badge {
    display:flex;
    align-items:center;
    gap:8px;
    font-family:'DM Mono', monospace;
    font-size:11px;
    color:var(--muted);
    letter-spacing:1px;
  }

  .status-dot {
    width:6px;
    height:6px;
    border-radius:50%;
    background:#4ade80;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%,100%{opacity:1;}
    50%{opacity:0.4;}
  }

  /* Hero */
  .hero {
    padding: 64px 0 40px;
    text-align:center;
  }

  .hero-eyebrow {
    font-family:'DM Mono', monospace;
    font-size:11px;
    letter-spacing:3px;
    color:var(--gold);
    text-transform:uppercase;
    margin-bottom:20px;
    opacity:0;
    animation: fadeUp 0.6s 0.2s forwards;
  }

  .hero-title {
    font-family:'Playfair Display', serif;
    font-size:clamp(36px, 6vw, 56px);
    font-weight:900;
    line-height:1.1;
    margin-bottom:16px;
    opacity:0;
    animation: fadeUp 0.6s 0.3s forwards;
  }

  .hero-title em {
    font-style:italic;
    color:var(--gold);
  }

  .hero-desc {
    font-size:15px;
    color:var(--muted);
    max-width:500px;
    margin:0 auto 40px;
    line-height:1.7;
    font-weight:300;
    opacity:0;
    animation: fadeUp 0.6s 0.4s forwards;
  }

  @keyframes fadeUp {
    from{opacity:0;transform:translateY(16px);}
    to{opacity:1;transform:translateY(0);}
  }

  /* Setup panel */
  .setup-panel {
    background: var(--deep);
    border: 1px solid var(--border);
    padding: 28px;
    margin-bottom: 28px;
    opacity:0;
    animation: fadeUp 0.6s 0.5s forwards;
  }

  .setup-title {
    font-family:'DM Mono', monospace;
    font-size:10px;
    letter-spacing:3px;
    color:var(--gold);
    text-transform:uppercase;
    margin-bottom:20px;
  }

  .setup-grid {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:16px;
  }

  @media(max-width:600px){ .setup-grid{grid-template-columns:1fr;} }

  .field-label {
    font-family:'DM Mono', monospace;
    font-size:10px;
    letter-spacing:2px;
    color:var(--muted);
    text-transform:uppercase;
    margin-bottom:8px;
    display:block;
  }

  .field-input {
    width:100%;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(201,168,76,0.2);
    color: var(--cream);
    padding: 10px 14px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    outline:none;
    transition: border-color 0.2s, background 0.2s;
  }

  .field-input:focus {
    border-color: var(--gold);
    background: rgba(201,168,76,0.05);
  }

  .field-input option { background: var(--deep); color: var(--cream); }

  /* Chat area */
  .chat-area {
    opacity:0;
    animation: fadeUp 0.6s 0.6s forwards;
  }

  .messages {
    min-height: 320px;
    max-height: 480px;
    overflow-y:auto;
    border: 1px solid var(--border);
    background: rgba(13,31,60,0.5);
    padding: 24px;
    margin-bottom: 16px;
    scroll-behavior: smooth;
  }

  .messages::-webkit-scrollbar { width:4px; }
  .messages::-webkit-scrollbar-track { background:transparent; }
  .messages::-webkit-scrollbar-thumb { background:var(--border); }

  .message {
    margin-bottom: 24px;
    animation: fadeUp 0.3s forwards;
  }

  .message:last-child { margin-bottom:0; }

  .msg-header {
    display:flex;
    align-items:center;
    gap:10px;
    margin-bottom:8px;
  }

  .msg-avatar {
    width:28px;
    height:28px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-family:'DM Mono', monospace;
    font-size:10px;
    font-weight:500;
    flex-shrink:0;
  }

  .msg-avatar.civic {
    background: linear-gradient(135deg, var(--gold), #a07830);
    color: var(--navy);
  }

  .msg-avatar.user {
    background: rgba(255,255,255,0.08);
    color: var(--muted);
    border: 1px solid rgba(255,255,255,0.1);
  }

  .msg-name {
    font-family:'DM Mono', monospace;
    font-size:10px;
    letter-spacing:2px;
    text-transform:uppercase;
  }

  .msg-name.civic { color:var(--gold); }
  .msg-name.user { color:var(--muted); }

  .msg-time {
    font-family:'DM Mono', monospace;
    font-size:9px;
    color:rgba(138,155,176,0.5);
    margin-left:auto;
  }

  .msg-body {
    font-size:14px;
    line-height:1.75;
    color:rgba(245,240,232,0.9);
    padding-left:38px;
  }

  .msg-body.user-body {
    color:var(--muted);
    font-style:italic;
  }

  .msg-body h4 {
    font-family:'Playfair Display', serif;
    font-size:15px;
    color:var(--gold-light);
    margin:14px 0 6px;
    font-weight:700;
  }

  .msg-body ul {
    padding-left:16px;
    margin:8px 0;
  }

  .msg-body li {
    margin-bottom:6px;
    color:rgba(245,240,232,0.8);
  }

  .msg-body .highlight-box {
    background: var(--glow);
    border-left: 2px solid var(--gold);
    padding: 10px 14px;
    margin: 12px 0;
    font-size:13px;
    color:var(--cream);
  }

  .msg-body .data-tag {
    display:inline-block;
    background:rgba(201,168,76,0.12);
    border:1px solid rgba(201,168,76,0.25);
    color:var(--gold-light);
    font-family:'DM Mono', monospace;
    font-size:10px;
    padding:2px 8px;
    margin:2px 3px;
    letter-spacing:1px;
  }

  /* Input area */
  .input-row {
    display:flex;
    gap:12px;
    align-items:flex-end;
  }

  .input-wrap {
    flex:1;
    position:relative;
  }

  .chat-input {
    width:100%;
    background: var(--deep);
    border: 1px solid var(--border);
    color: var(--cream);
    padding: 14px 16px;
    font-family: 'DM Sans', sans-serif;
    font-size:14px;
    outline:none;
    resize:none;
    min-height:52px;
    max-height:140px;
    line-height:1.5;
    transition: border-color 0.2s;
  }

  .chat-input:focus { border-color:var(--gold); }
  .chat-input::placeholder { color:rgba(138,155,176,0.5); }

  .send-btn {
    background: var(--gold);
    color: var(--navy);
    border:none;
    padding: 0 24px;
    height:52px;
    font-family:'DM Mono', monospace;
    font-size:11px;
    letter-spacing:2px;
    text-transform:uppercase;
    cursor:pointer;
    transition: background 0.2s, transform 0.1s;
    font-weight:500;
    white-space:nowrap;
  }

  .send-btn:hover { background:var(--gold-light); }
  .send-btn:active { transform:scale(0.98); }
  .send-btn:disabled { opacity:0.5; cursor:not-allowed; }

  /* Quick prompts */
  .quick-prompts {
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin-top:12px;
    opacity:0;
    animation: fadeUp 0.6s 0.7s forwards;
  }

  .quick-prompt {
    background:transparent;
    border:1px solid var(--border);
    color:var(--muted);
    font-family:'DM Mono', monospace;
    font-size:10px;
    letter-spacing:1px;
    padding:6px 12px;
    cursor:pointer;
    text-transform:uppercase;
    transition: all 0.2s;
  }

  .quick-prompt:hover {
    border-color:var(--gold);
    color:var(--gold);
    background:var(--glow);
  }

  /* Footer */
  footer {
    text-align:center;
    padding:40px 0 24px;
    font-family:'DM Mono', monospace;
    font-size:10px;
    color:rgba(138,155,176,0.3);
    letter-spacing:2px;
    text-transform:uppercase;
    border-top:1px solid rgba(201,168,76,0.07);
    margin-top:48px;
  }

  /* Typing indicator */
  .typing {
    display:flex;
    align-items:center;
    gap:4px;
    padding-left:38px;
    height:20px;
  }

  .typing span {
    width:5px;
    height:5px;
    background:var(--gold);
    border-radius:50%;
    animation:typingDot 1.2s infinite;
    opacity:0.4;
  }

  .typing span:nth-child(2){animation-delay:0.2s;}
  .typing span:nth-child(3){animation-delay:0.4s;}

  @keyframes typingDot {
    0%,100%{opacity:0.2;transform:translateY(0);}
    50%{opacity:1;transform:translateY(-3px);}
  }

  .divider-line {
    border:none;
    border-top:1px solid var(--border);
    margin:32px 0;
  }
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="logo">
      <div class="logo-mark">C</div>
      <div>
        <div class="logo-text">CIVIC</div>
        <div class="logo-sub">Strategic Intelligence</div>
      </div>
    </div>
    <div class="status-badge">
      <div class="status-dot"></div>
      LIVE MARKET DATA
    </div>
  </div>
</header>

<div class="container">
  <div class="hero">
    <div class="hero-eyebrow">Municipal · County · District</div>
    <h1 class="hero-title">Your <em>Strategic</em><br>Policy Advisor</h1>
    <p class="hero-desc">Real-time economic intelligence and policy strategy for local leaders — from mayors to city council members to county commissioners.</p>
  </div>

  <div class="setup-panel">
    <div class="setup-title">// Your Office</div>
    <div class="setup-grid">
      <div>
        <label class="field-label">Your Title</label>
        <select class="field-input" id="roleSelect">
          <option value="Mayor">Mayor</option>
          <option value="City Council Member">City Council Member</option>
          <option value="County Commissioner">County Commissioner</option>
          <option value="State Representative">State Representative</option>
          <option value="District Supervisor">District Supervisor</option>
          <option value="City Manager">City Manager</option>
          <option value="Town Selectperson">Town Selectperson</option>
        </select>
      </div>
      <div>
        <label class="field-label">Jurisdiction / City</label>
        <input class="field-input" id="jurisdictionInput" type="text" placeholder="e.g. Austin, TX · Pop. 978,000" />
      </div>
    </div>
  </div>

  <div class="chat-area">
    <div class="messages" id="messages">
      <div class="message">
        <div class="msg-header">
          <div class="msg-avatar civic">AI</div>
          <span class="msg-name civic">CIVIC Advisor</span>
          <span class="msg-time">Ready</span>
        </div>
        <div class="msg-body">
          Welcome. I'm your AI strategic advisor — built specifically for local government leaders. I combine real-time market data, economic signals, and policy research to help you make decisions that move your community forward.
          <div class="highlight-box">
            Set your role and jurisdiction above, then ask me anything — budget strategy, economic development, housing policy, constituent concerns, federal grant opportunities, or how external market conditions are affecting your district.
          </div>
          What are you working on?
        </div>
      </div>
    </div>

    <div class="input-row">
      <div class="input-wrap">
        <textarea class="chat-input" id="chatInput" placeholder="Ask about your district's economic outlook, policy strategy, housing, jobs, infrastructure..." rows="1"></textarea>
      </div>
      <button class="send-btn" id="sendBtn">Send →</button>
    </div>

    <div class="quick-prompts">
      <button class="quick-prompt" onclick="quickPrompt('What economic conditions should I be aware of right now that affect my city?')">Current Economic Climate</button>
      <button class="quick-prompt" onclick="quickPrompt('What federal grants are available for infrastructure right now?')">Federal Grants</button>
      <button class="quick-prompt" onclick="quickPrompt('How should I approach a housing affordability crisis in my district?')">Housing Strategy</button>
      <button class="quick-prompt" onclick="quickPrompt('My city is losing businesses to neighboring towns. What retention strategies work?')">Business Retention</button>
      <button class="quick-prompt" onclick="quickPrompt('How do I build a case for a property tax adjustment to council?')">Tax Policy</button>
      <button class="quick-prompt" onclick="quickPrompt('What workforce development programs should my city be investing in?')">Workforce Dev</button>
    </div>
  </div>

  <hr class="divider-line">
  
  <footer>CIVIC · AI Strategic Intelligence for Local Government · Powered by Anthropic Claude</footer>
</div>

<script>
  const messagesEl = document.getElementById('messages');
  const chatInput = document.getElementById('chatInput');
  const sendBtn = document.getElementById('sendBtn');

  const conversationHistory = [];

  function getSystemPrompt() {
    const role = document.getElementById('roleSelect').value;
    const jurisdiction = document.getElementById('jurisdictionInput').value || 'an unnamed jurisdiction';

    return `You are CIVIC, an elite AI strategic advisor for local government leaders — the municipal equivalent of a McKinsey or BCG consultant, but purpose-built for mayors, city council members, county commissioners, representatives, and other local officials.

The leader you are advising is: ${role} of ${jurisdiction}.

Your expertise spans:
- Municipal finance, budgeting, and bond strategy
- Local economic development and business attraction/retention
- Housing policy, zoning, and affordability strategy
- Infrastructure planning and prioritization
- Federal and state grant identification and application strategy
- Workforce development and labor market dynamics
- Public safety and community health
- Constituent communication and political strategy
- How national/global economic conditions affect local governments specifically
- Public-private partnerships

Your communication style:
- Direct, confident, and specific — like a senior partner at a top strategy firm
- Lead with the insight or recommendation, then support it
- Use real frameworks (cost-benefit, SWOT, stakeholder mapping, economic multipliers) naturally
- Acknowledge local political realities — you understand this is politics, not just policy
- Provide concrete, actionable next steps, not vague advice
- When discussing economic conditions, translate macro trends into their local impact
- If web search has given you current data, reference it specifically
- Use formatting naturally: headers for multi-part answers, bullet points for lists of options
- Be the advisor who tells the truth, not just what sounds good

When you don't have specific data about their exact jurisdiction, say so and work with what you know, or ask a targeted clarifying question.

Today's date context: February 2026.`;
  }

  function addMessage(role, content, time) {
    const msg = document.createElement('div');
    msg.className = 'message';
    const t = time || new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    const isUser = role === 'user';

    msg.innerHTML = `
      <div class="msg-header">
        <div class="msg-avatar ${isUser ? 'user' : 'civic'}">${isUser ? 'YOU' : 'AI'}</div>
        <span class="msg-name ${isUser ? 'user' : 'civic'}">${isUser ? 'You' : 'CIVIC Advisor'}</span>
        <span class="msg-time">${t}</span>
      </div>
      <div class="msg-body ${isUser ? 'user-body' : ''}">${isUser ? escapeHtml(content) : formatResponse(content)}</div>
    `;
    messagesEl.appendChild(msg);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  function addTyping() {
    const div = document.createElement('div');
    div.id = 'typing-indicator';
    div.className = 'message';
    div.innerHTML = `
      <div class="msg-header">
        <div class="msg-avatar civic">AI</div>
        <span class="msg-name civic">CIVIC Advisor</span>
      </div>
      <div class="typing"><span></span><span></span><span></span></div>
    `;
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
    return div;
  }

  function removeTyping() {
    const el = document.getElementById('typing-indicator');
    if(el) el.remove();
  }

  function escapeHtml(str) {
    return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  function formatResponse(text) {
    // Convert markdown-ish to HTML
    return text
      .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
      .replace(/^### (.+)$/gm, '<h4>$1</h4>')
      .replace(/^## (.+)$/gm, '<h4>$1</h4>')
      .replace(/^# (.+)$/gm, '<h4>$1</h4>')
      .replace(/^- (.+)$/gm, '<li>$1</li>')
      .replace(/(<li>.*<\/li>\n?)+/g, m => `<ul>${m}</ul>`)
      .replace(/\n\n/g, '</p><p>')
      .replace(/\n/g, '<br>')
      .replace(/^(.+)$/, '<p>$1</p>');
  }

  async function sendMessage(text) {
    if (!text.trim()) return;

    sendBtn.disabled = true;
    addMessage('user', text);
    conversationHistory.push({ role: 'user', content: text });

    const typingEl = addTyping();

    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          system: getSystemPrompt(),
          messages: conversationHistory
        })
      });

      const data = await response.json();

      const fullResponse = (data.content || [])
        .map(item => item.type === 'text' ? item.text : '')
        .filter(Boolean)
        .join('\n');

      removeTyping();
      const assistantText = fullResponse || "I apologize, I wasn't able to generate a response. Please try again.";
      addMessage('civic', assistantText);
      conversationHistory.push({ role: 'assistant', content: assistantText });

    } catch(err) {
      removeTyping();
      addMessage('civic', 'I encountered an error reaching my analysis systems. Please check your connection and try again.');
    }

    sendBtn.disabled = false;
    chatInput.focus();
  }

  function quickPrompt(text) {
    chatInput.value = text;
    chatInput.style.height = 'auto';
    chatInput.style.height = chatInput.scrollHeight + 'px';
    chatInput.focus();
  }

  sendBtn.addEventListener('click', () => {
    const val = chatInput.value.trim();
    if (val) {
      chatInput.value = '';
      chatInput.style.height = '52px';
      sendMessage(val);
    }
  });

  chatInput.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendBtn.click();
    }
  });

  chatInput.addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = Math.min(this.scrollHeight, 140) + 'px';
  });
</script>
</body>
</html>
<!-- <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CIVIC · AI Strategic Advisor</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --navy: #0a1628;
    --deep: #0d1f3c;
    --gold: #c9a84c;
    --gold-light: #e8c96a;
    --cream: #f5f0e8;
    --slate: #4a5568;
    --muted: #8a9bb0;
    --border: rgba(201,168,76,0.2);
    --glow: rgba(201,168,76,0.08);
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    background: var(--navy);
    color: var(--cream);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Subtle grid background */
  body::before {
    content:'';
    position:fixed;
    inset:0;
    background-image: 
      linear-gradient(rgba(201,168,76,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(201,168,76,0.03) 1px, transparent 1px);
    background-size: 60px 60px;
    pointer-events:none;
    z-index:0;
  }

  .container {
    position: relative;
    z-index:1;
    max-width: 900px;
    margin: 0 auto;
    padding: 0 24px;
  }

  /* Header */
  header {
    border-bottom: 1px solid var(--border);
    padding: 20px 0;
    background: rgba(10,22,40,0.9);
    backdrop-filter: blur(10px);
    position: sticky;
    top:0;
    z-index:100;
  }

  .header-inner {
    display:flex;
    align-items:center;
    justify-content:space-between;
    max-width:900px;
    margin:0 auto;
    padding:0 24px;
  }

  .logo {
    display:flex;
    align-items:center;
    gap:12px;
  }

  .logo-mark {
    width:36px;
    height:36px;
    border:2px solid var(--gold);
    display:flex;
    align-items:center;
    justify-content:center;
    font-family:'DM Mono', monospace;
    font-size:14px;
    color:var(--gold);
    font-weight:500;
    position:relative;
  }

  .logo-mark::before {
    content:'';
    position:absolute;
    inset:-4px;
    border:1px solid rgba(201,168,76,0.2);
  }

  .logo-text {
    font-family:'Playfair Display', serif;
    font-size:20px;
    font-weight:700;
    letter-spacing:3px;
    color:var(--cream);
  }

  .logo-sub {
    font-family:'DM Mono', monospace;
    font-size:10px;
    color:var(--gold);
    letter-spacing:2px;
    text-transform:uppercase;
  }

  .status-badge {
    display:flex;
    align-items:center;
    gap:8px;
    font-family:'DM Mono', monospace;
    font-size:11px;
    color:var(--muted);
    letter-spacing:1px;
  }

  .status-dot {
    width:6px;
    height:6px;
    border-radius:50%;
    background:#4ade80;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%,100%{opacity:1;}
    50%{opacity:0.4;}
  }

  /* Hero */
  .hero {
    padding: 64px 0 40px;
    text-align:center;
  }

  .hero-eyebrow {
    font-family:'DM Mono', monospace;
    font-size:11px;
    letter-spacing:3px;
    color:var(--gold);
    text-transform:uppercase;
    margin-bottom:20px;
    opacity:0;
    animation: fadeUp 0.6s 0.2s forwards;
  }

  .hero-title {
    font-family:'Playfair Display', serif;
    font-size:clamp(36px, 6vw, 56px);
    font-weight:900;
    line-height:1.1;
    margin-bottom:16px;
    opacity:0;
    animation: fadeUp 0.6s 0.3s forwards;
  }

  .hero-title em {
    font-style:italic;
    color:var(--gold);
  }

  .hero-desc {
    font-size:15px;
    color:var(--muted);
    max-width:500px;
    margin:0 auto 40px;
    line-height:1.7;
    font-weight:300;
    opacity:0;
    animation: fadeUp 0.6s 0.4s forwards;
  }

  @keyframes fadeUp {
    from{opacity:0;transform:translateY(16px);}
    to{opacity:1;transform:translateY(0);}
  }

  /* Setup panel */
  .setup-panel {
    background: var(--deep);
    border: 1px solid var(--border);
    padding: 28px;
    margin-bottom: 28px;
    opacity:0;
    animation: fadeUp 0.6s 0.5s forwards;
  }

  .setup-title {
    font-family:'DM Mono', monospace;
    font-size:10px;
    letter-spacing:3px;
    color:var(--gold);
    text-transform:uppercase;
    margin-bottom:20px;
  }

  .setup-grid {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:16px;
  }

  @media(max-width:600px){ .setup-grid{grid-template-columns:1fr;} }

  .field-label {
    font-family:'DM Mono', monospace;
    font-size:10px;
    letter-spacing:2px;
    color:var(--muted);
    text-transform:uppercase;
    margin-bottom:8px;
    display:block;
  }

  .field-input {
    width:100%;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(201,168,76,0.2);
    color: var(--cream);
    padding: 10px 14px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    outline:none;
    transition: border-color 0.2s, background 0.2s;
  }

  .field-input:focus {
    border-color: var(--gold);
    background: rgba(201,168,76,0.05);
  }

  .field-input option { background: var(--deep); color: var(--cream); }

  /* Chat area */
  .chat-area {
    opacity:0;
    animation: fadeUp 0.6s 0.6s forwards;
  }

  .messages {
    min-height: 320px;
    max-height: 480px;
    overflow-y:auto;
    border: 1px solid var(--border);
    background: rgba(13,31,60,0.5);
    padding: 24px;
    margin-bottom: 16px;
    scroll-behavior: smooth;
  }

  .messages::-webkit-scrollbar { width:4px; }
  .messages::-webkit-scrollbar-track { background:transparent; }
  .messages::-webkit-scrollbar-thumb { background:var(--border); }

  .message {
    margin-bottom: 24px;
    animation: fadeUp 0.3s forwards;
  }

  .message:last-child { margin-bottom:0; }

  .msg-header {
    display:flex;
    align-items:center;
    gap:10px;
    margin-bottom:8px;
  }

  .msg-avatar {
    width:28px;
    height:28px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-family:'DM Mono', monospace;
    font-size:10px;
    font-weight:500;
    flex-shrink:0;
  }

  .msg-avatar.civic {
    background: linear-gradient(135deg, var(--gold), #a07830);
    color: var(--navy);
  }

  .msg-avatar.user {
    background: rgba(255,255,255,0.08);
    color: var(--muted);
    border: 1px solid rgba(255,255,255,0.1);
  }

  .msg-name {
    font-family:'DM Mono', monospace;
    font-size:10px;
    letter-spacing:2px;
    text-transform:uppercase;
  }

  .msg-name.civic { color:var(--gold); }
  .msg-name.user { color:var(--muted); }

  .msg-time {
    font-family:'DM Mono', monospace;
    font-size:9px;
    color:rgba(138,155,176,0.5);
    margin-left:auto;
  }

  .msg-body {
    font-size:14px;
    line-height:1.75;
    color:rgba(245,240,232,0.9);
    padding-left:38px;
  }

  .msg-body.user-body {
    color:var(--muted);
    font-style:italic;
  }

  .msg-body h4 {
    font-family:'Playfair Display', serif;
    font-size:15px;
    color:var(--gold-light);
    margin:14px 0 6px;
    font-weight:700;
  }

  .msg-body ul {
    padding-left:16px;
    margin:8px 0;
  }

  .msg-body li {
    margin-bottom:6px;
    color:rgba(245,240,232,0.8);
  }

  .msg-body .highlight-box {
    background: var(--glow);
    border-left: 2px solid var(--gold);
    padding: 10px 14px;
    margin: 12px 0;
    font-size:13px;
    color:var(--cream);
  }

  .msg-body .data-tag {
    display:inline-block;
    background:rgba(201,168,76,0.12);
    border:1px solid rgba(201,168,76,0.25);
    color:var(--gold-light);
    font-family:'DM Mono', monospace;
    font-size:10px;
    padding:2px 8px;
    margin:2px 3px;
    letter-spacing:1px;
  }

  /* Input area */
  .input-row {
    display:flex;
    gap:12px;
    align-items:flex-end;
  }

  .input-wrap {
    flex:1;
    position:relative;
  }

  .chat-input {
    width:100%;
    background: var(--deep);
    border: 1px solid var(--border);
    color: var(--cream);
    padding: 14px 16px;
    font-family: 'DM Sans', sans-serif;
    font-size:14px;
    outline:none;
    resize:none;
    min-height:52px;
    max-height:140px;
    line-height:1.5;
    transition: border-color 0.2s;
  }

  .chat-input:focus { border-color:var(--gold); }
  .chat-input::placeholder { color:rgba(138,155,176,0.5); }

  .send-btn {
    background: var(--gold);
    color: var(--navy);
    border:none;
    padding: 0 24px;
    height:52px;
    font-family:'DM Mono', monospace;
    font-size:11px;
    letter-spacing:2px;
    text-transform:uppercase;
    cursor:pointer;
    transition: background 0.2s, transform 0.1s;
    font-weight:500;
    white-space:nowrap;
  }

  .send-btn:hover { background:var(--gold-light); }
  .send-btn:active { transform:scale(0.98); }
  .send-btn:disabled { opacity:0.5; cursor:not-allowed; }

  /* Quick prompts */
  .quick-prompts {
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin-top:12px;
    opacity:0;
    animation: fadeUp 0.6s 0.7s forwards;
  }

  .quick-prompt {
    background:transparent;
    border:1px solid var(--border);
    color:var(--muted);
    font-family:'DM Mono', monospace;
    font-size:10px;
    letter-spacing:1px;
    padding:6px 12px;
    cursor:pointer;
    text-transform:uppercase;
    transition: all 0.2s;
  }

  .quick-prompt:hover {
    border-color:var(--gold);
    color:var(--gold);
    background:var(--glow);
  }

  /* Footer */
  footer {
    text-align:center;
    padding:40px 0 24px;
    font-family:'DM Mono', monospace;
    font-size:10px;
    color:rgba(138,155,176,0.3);
    letter-spacing:2px;
    text-transform:uppercase;
    border-top:1px solid rgba(201,168,76,0.07);
    margin-top:48px;
  }

  /* Typing indicator */
  .typing {
    display:flex;
    align-items:center;
    gap:4px;
    padding-left:38px;
    height:20px;
  }

  .typing span {
    width:5px;
    height:5px;
    background:var(--gold);
    border-radius:50%;
    animation:typingDot 1.2s infinite;
    opacity:0.4;
  }

  .typing span:nth-child(2){animation-delay:0.2s;}
  .typing span:nth-child(3){animation-delay:0.4s;}

  @keyframes typingDot {
    0%,100%{opacity:0.2;transform:translateY(0);}
    50%{opacity:1;transform:translateY(-3px);}
  }

  .divider-line {
    border:none;
    border-top:1px solid var(--border);
    margin:32px 0;
  }
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="logo">
      <div class="logo-mark">C</div>
      <div>
        <div class="logo-text">CIVIC</div>
        <div class="logo-sub">Strategic Intelligence</div>
      </div>
    </div>
    <div class="status-badge">
      <div class="status-dot"></div>
      LIVE MARKET DATA
    </div>
  </div>
</header>

<div class="container">
  <div class="hero">
    <div class="hero-eyebrow">Municipal · County · District</div>
    <h1 class="hero-title">Your <em>Strategic</em><br>Policy Advisor</h1>
    <p class="hero-desc">Real-time economic intelligence and policy strategy for local leaders — from mayors to city council members to county commissioners.</p>
  </div>

  <div class="setup-panel">
    <div class="setup-title">// Your Office</div>
    <div class="setup-grid">
      <div>
        <label class="field-label">Your Title</label>
        <select class="field-input" id="roleSelect">
          <option value="Mayor">Mayor</option>
          <option value="City Council Member">City Council Member</option>
          <option value="County Commissioner">County Commissioner</option>
          <option value="State Representative">State Representative</option>
          <option value="District Supervisor">District Supervisor</option>
          <option value="City Manager">City Manager</option>
          <option value="Town Selectperson">Town Selectperson</option>
        </select>
      </div>
      <div>
        <label class="field-label">Jurisdiction / City</label>
        <input class="field-input" id="jurisdictionInput" type="text" placeholder="e.g. Austin, TX · Pop. 978,000" />
      </div>
    </div>
  </div>

  <div class="chat-area">
    <div class="messages" id="messages">
      <div class="message">
        <div class="msg-header">
          <div class="msg-avatar civic">AI</div>
          <span class="msg-name civic">CIVIC Advisor</span>
          <span class="msg-time">Ready</span>
        </div>
        <div class="msg-body">
          Welcome. I'm your AI strategic advisor — built specifically for local government leaders. I combine real-time market data, economic signals, and policy research to help you make decisions that move your community forward.
          <div class="highlight-box">
            Set your role and jurisdiction above, then ask me anything — budget strategy, economic development, housing policy, constituent concerns, federal grant opportunities, or how external market conditions are affecting your district.
          </div>
          What are you working on?
        </div>
      </div>
    </div>

    <div class="input-row">
      <div class="input-wrap">
        <textarea class="chat-input" id="chatInput" placeholder="Ask about your district's economic outlook, policy strategy, housing, jobs, infrastructure..." rows="1"></textarea>
      </div>
      <button class="send-btn" id="sendBtn">Send →</button>
    </div>

    <div class="quick-prompts">
      <button class="quick-prompt" onclick="quickPrompt('What economic conditions should I be aware of right now that affect my city?')">Current Economic Climate</button>
      <button class="quick-prompt" onclick="quickPrompt('What federal grants are available for infrastructure right now?')">Federal Grants</button>
      <button class="quick-prompt" onclick="quickPrompt('How should I approach a housing affordability crisis in my district?')">Housing Strategy</button>
      <button class="quick-prompt" onclick="quickPrompt('My city is losing businesses to neighboring towns. What retention strategies work?')">Business Retention</button>
      <button class="quick-prompt" onclick="quickPrompt('How do I build a case for a property tax adjustment to council?')">Tax Policy</button>
      <button class="quick-prompt" onclick="quickPrompt('What workforce development programs should my city be investing in?')">Workforce Dev</button>
    </div>
  </div>

  <hr class="divider-line">
  
  <footer>CIVIC · AI Strategic Intelligence for Local Government · Powered by Anthropic Claude</footer>
</div>

<script>
  const messagesEl = document.getElementById('messages');
  const chatInput = document.getElementById('chatInput');
  const sendBtn = document.getElementById('sendBtn');

  const conversationHistory = [];

  function getSystemPrompt() {
    const role = document.getElementById('roleSelect').value;
    const jurisdiction = document.getElementById('jurisdictionInput').value || 'an unnamed jurisdiction';

    return `You are CIVIC, an elite AI strategic advisor for local government leaders — the municipal equivalent of a McKinsey or BCG consultant, but purpose-built for mayors, city council members, county commissioners, representatives, and other local officials.

The leader you are advising is: ${role} of ${jurisdiction}.

Your expertise spans:
- Municipal finance, budgeting, and bond strategy
- Local economic development and business attraction/retention
- Housing policy, zoning, and affordability strategy
- Infrastructure planning and prioritization
- Federal and state grant identification and application strategy
- Workforce development and labor market dynamics
- Public safety and community health
- Constituent communication and political strategy
- How national/global economic conditions affect local governments specifically
- Public-private partnerships

Your communication style:
- Direct, confident, and specific — like a senior partner at a top strategy firm
- Lead with the insight or recommendation, then support it
- Use real frameworks (cost-benefit, SWOT, stakeholder mapping, economic multipliers) naturally
- Acknowledge local political realities — you understand this is politics, not just policy
- Provide concrete, actionable next steps, not vague advice
- When discussing economic conditions, translate macro trends into their local impact
- If web search has given you current data, reference it specifically
- Use formatting naturally: headers for multi-part answers, bullet points for lists of options
- Be the advisor who tells the truth, not just what sounds good

When you don't have specific data about their exact jurisdiction, say so and work with what you know, or ask a targeted clarifying question.

Today's date context: February 2026.`;
  }

  function addMessage(role, content, time) {
    const msg = document.createElement('div');
    msg.className = 'message';
    const t = time || new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    const isUser = role === 'user';

    msg.innerHTML = `
      <div class="msg-header">
        <div class="msg-avatar ${isUser ? 'user' : 'civic'}">${isUser ? 'YOU' : 'AI'}</div>
        <span class="msg-name ${isUser ? 'user' : 'civic'}">${isUser ? 'You' : 'CIVIC Advisor'}</span>
        <span class="msg-time">${t}</span>
      </div>
      <div class="msg-body ${isUser ? 'user-body' : ''}">${isUser ? escapeHtml(content) : formatResponse(content)}</div>
    `;
    messagesEl.appendChild(msg);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  function addTyping() {
    const div = document.createElement('div');
    div.id = 'typing-indicator';
    div.className = 'message';
    div.innerHTML = `
      <div class="msg-header">
        <div class="msg-avatar civic">AI</div>
        <span class="msg-name civic">CIVIC Advisor</span>
      </div>
      <div class="typing"><span></span><span></span><span></span></div>
    `;
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
    return div;
  }

  function removeTyping() {
    const el = document.getElementById('typing-indicator');
    if(el) el.remove();
  }

  function escapeHtml(str) {
    return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  function formatResponse(text) {
    // Convert markdown-ish to HTML
    return text
      .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
      .replace(/^### (.+)$/gm, '<h4>$1</h4>')
      .replace(/^## (.+)$/gm, '<h4>$1</h4>')
      .replace(/^# (.+)$/gm, '<h4>$1</h4>')
      .replace(/^- (.+)$/gm, '<li>$1</li>')
      .replace(/(<li>.*<\/li>\n?)+/g, m => `<ul>${m}</ul>`)
      .replace(/\n\n/g, '</p><p>')
      .replace(/\n/g, '<br>')
      .replace(/^(.+)$/, '<p>$1</p>');
  }

  async function sendMessage(text) {
    if (!text.trim()) return;

    sendBtn.disabled = true;
    addMessage('user', text);
    conversationHistory.push({ role: 'user', content: text });

    const typingEl = addTyping();

    try {
      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 1000,
          system: getSystemPrompt(),
          tools: [{ type: 'web_search_20250305', name: 'web_search' }],
          messages: conversationHistory
        })
      });

      const data = await response.json();

      const fullResponse = (data.content || [])
        .map(item => item.type === 'text' ? item.text : '')
        .filter(Boolean)
        .join('\n');

      removeTyping();
      const assistantText = fullResponse || "I apologize, I wasn't able to generate a response. Please try again.";
      addMessage('civic', assistantText);
      conversationHistory.push({ role: 'assistant', content: assistantText });

    } catch(err) {
      removeTyping();
      addMessage('civic', 'I encountered an error reaching my analysis systems. Please check your connection and try again.');
    }

    sendBtn.disabled = false;
    chatInput.focus();
  }

  function quickPrompt(text) {
    chatInput.value = text;
    chatInput.style.height = 'auto';
    chatInput.style.height = chatInput.scrollHeight + 'px';
    chatInput.focus();
  }

  sendBtn.addEventListener('click', () => {
    const val = chatInput.value.trim();
    if (val) {
      chatInput.value = '';
      chatInput.style.height = '52px';
      sendMessage(val);
    }
  });

  chatInput.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendBtn.click();
    }
  });

  chatInput.addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = Math.min(this.scrollHeight, 140) + 'px';
  });
</script>
</body>
</html> -->
